<%- include('header.ejs') -%>
  <%- include("nav.ejs") %>

  <main class="container my-5">
    <h1 class="mb-3">Users</h1>

    <div class="table-responsive">
      <table id="users" class="table table-hover align-middle">
      <thead>
        <tr>
          <th>User Name</th>
          <th>Email</th>
          <th>createdAt</th>
        </tr>
      </thead>
      <tbody>
        <% (users || []).forEach(function(user){ %>
          <% const uid = user.id || user._id; %>
          <tr class="clickable-row" tabindex="0" data-href="/user/<%= uid %>">
            <td><a href="/user/<%= uid %>" class="row-link"><%= user.name %></a></td>
            <td><%= user.email %></td>
            <td><%= user.createdAt ? new Date(user.createdAt).toLocaleString() : '' %></td>
          </tr>
        <% }) %>
      </tbody>
      </table>
    </div>
  </main>

<%- include('footer.ejs') -%>

<script>
  // Make table rows keyboard-accessible and clickable
  (function(){
    const rows = document.querySelectorAll('#users tbody tr[data-href]');
    rows.forEach(row => {
      row.addEventListener('click', () => {
        const href = row.getAttribute('data-href');
        if (href) window.location.href = href;
      });

      row.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          const href = row.getAttribute('data-href');
          if (href) window.location.href = href;
        }
      });
    });
  })();
</script>